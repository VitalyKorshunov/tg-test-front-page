<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 2rem;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        .btn {
            padding: 10px 20px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            background-color: #2ea6ff;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>üë§ Telegram Mini App</h1>
<p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <b id="username">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</b>!</p>
<button class="btn" onclick="Telegram.WebApp.close()">–ó–∞–∫—Ä—ã—Ç—å!</button>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();

  const initDataUnsafe = tg.initDataUnsafe;
  const user = initDataUnsafe?.user;
  document.getElementById("username").textContent = user?.first_name || "–≥–æ—Å—Ç—å";

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –±–µ–∫
  async function sendInitDataToBackend() {
    try {
      const initData = tg.initData; // –≠—Ç–æ —Å—Ç—Ä–æ–∫–∞ —Å initData

      const response = await fetch('https://cutting-stack-month-welding.trycloudflare.com/auth', {
        method: 'POST', // –∏–ª–∏ GET, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç API
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `tga ${initData}`,  // –î–æ–±–∞–≤–ª—è–µ–º initData –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º 'tga '
        },
        // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
        // body: JSON.stringify({ someData: 123 })
      });

      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      const data = await response.json();
      console.log('Response from backend:', data);
    } catch (error) {
      console.error('Error sending initData:', error);
    }
  }

  // –í—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  sendInitDataToBackend();
</script>
</body>
</html>
